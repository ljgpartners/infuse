/*!
 * jquery.event.drag - v 2.0.0
 * Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 * Open Source MIT License - http://threedubmedia.com/code/license
 */(function(e){e.fn.drag=function(t,n,r){var i=typeof t=="string"?t:"",s=e.isFunction(t)?t:e.isFunction(n)?n:null;i.indexOf("drag")!==0&&(i="drag"+i);r=(t==s?n:r)||{};return s?this.bind(i,r,s):this.trigger(i)};var t=e.event,n=t.special,r=n.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",livekey:"livedrag",add:function(n){var s=e.data(this,r.datakey),o=n.data||{};s.related+=1;if(!s.live&&n.selector){s.live=!0;t.add(this,"draginit."+r.livekey,r.delegate)}e.each(r.defaults,function(e){o[e]!==undefined&&(s[e]=o[e])})},remove:function(){e.data(this,r.datakey).related-=1},setup:function(){if(!e.data(this,r.datakey)){var n=e.extend({related:0},r.defaults);e.data(this,r.datakey,n);t.add(this,"mousedown",r.init,n);this.attachEvent&&this.attachEvent("ondragstart",r.dontstart)}},teardown:function(){if(!e.data(this,r.datakey).related){e.removeData(this,r.datakey);t.remove(this,"mousedown",r.init);t.remove(this,"draginit",r.delegate);r.textselect(!0);this.detachEvent&&this.detachEvent("ondragstart",r.dontstart)}},init:function(s){var o=s.data,u;if(!(o.which>0&&s.which!=o.which)&&!e(s.target).is(o.not))if(!o.handle||!!e(s.target).closest(o.handle,s.currentTarget).length){o.propagates=1;o.interactions=[r.interaction(this,o)];o.target=s.target;o.pageX=s.pageX;o.pageY=s.pageY;o.dragging=null;u=r.hijack(s,"draginit",o);if(o.propagates){if((u=r.flatten(u))&&u.length){o.interactions=[];e.each(u,function(){o.interactions.push(r.interaction(this,o))})}o.propagates=o.interactions.length;o.drop!==!1&&n.drop&&n.drop.handler(s,o);r.textselect(!1);t.add(document,"mousemove mouseup",r.handler,o);return!1}}},interaction:function(t,n){return{drag:t,callback:new r.callback,droppable:[],offset:e(t)[n.relative?"position":"offset"]()||{top:0,left:0}}},handler:function(e){var s=e.data;switch(e.type){case!s.dragging&&"mousemove":if(Math.pow(e.pageX-s.pageX,2)+Math.pow(e.pageY-s.pageY,2)<Math.pow(s.distance,2))break;e.target=s.target;r.hijack(e,"dragstart",s);s.propagates&&(s.dragging=!0);case"mousemove":if(s.dragging){r.hijack(e,"drag",s);if(s.propagates){s.drop!==!1&&n.drop&&n.drop.handler(e,s);break}e.type="mouseup"};case"mouseup":t.remove(document,"mousemove mouseup",r.handler);if(s.dragging){s.drop!==!1&&n.drop&&n.drop.handler(e,s);r.hijack(e,"dragend",s)}r.textselect(!0);if(s.click===!1&&s.dragging){jQuery.event.triggered=!0;setTimeout(function(){jQuery.event.triggered=!1},20);s.dragging=!1}}},delegate:function(n){var s=[],o,u=e.data(this,"events")||{};e.each(u.live||[],function(u,l){if(l.preType.indexOf("drag")===0)if(o=e(n.target).closest(l.selector,n.currentTarget)[0]){t.add(o,l.origType+"."+r.livekey,l.origHandler,l.data);e.inArray(o,s)<0&&s.push(o)}});return s.length?e(s).bind("dragend."+r.livekey,function(){t.remove(this,"."+r.livekey)}):!1},hijack:function(n,s,o,u,a){if(o){var l={event:n.originalEvent,type:n.type},h=s.indexOf("drop")?"drag":"drop",p,d=u||0,v,m;u=isNaN(u)?o.interactions.length:u;n.type=s;n.originalEvent=null;o.results=[];do if(v=o.interactions[d])if(s==="dragend"||!v.cancelled){m=r.properties(n,o,v);v.results=[];e(a||v[h]||o.droppable).each(function(u,a){p=(m.target=a)?t.handle.call(a,n,m):null;if(p===!1){if(h=="drag"){v.cancelled=!0;o.propagates-=1}s=="drop"&&(v[h][u]=null)}else s=="dropinit"&&v.droppable.push(r.element(p)||a);s=="dragstart"&&(v.proxy=e(r.element(p)||v.drag)[0]);v.results.push(p);delete n.result;if(s!=="dropinit")return p});o.results[d]=r.flatten(v.results);s=="dropinit"&&(v.droppable=r.flatten(v.droppable));s=="dragstart"&&!v.cancelled&&m.update()}while(++d<u);n.type=l.type;n.originalEvent=l.event;return r.flatten(o.results)}},properties:function(e,t,n){var i=n.callback;i.drag=n.drag;i.proxy=n.proxy||n.drag;i.startX=t.pageX;i.startY=t.pageY;i.deltaX=e.pageX-t.pageX;i.deltaY=e.pageY-t.pageY;i.originalX=n.offset.left;i.originalY=n.offset.top;i.offsetX=e.pageX-(t.pageX-i.originalX);i.offsetY=e.pageY-(t.pageY-i.originalY);i.drop=r.flatten((n.drop||[]).slice());i.available=r.flatten((n.droppable||[]).slice());return i},element:function(e){if(e&&(e.jquery||e.nodeType==1))return e},flatten:function(t){return e.map(t,function(t){return t&&t.jquery?e.makeArray(t):t&&t.length?r.flatten(t):t})},textselect:function(t){e(document)[t?"unbind":"bind"]("selectstart",r.dontstart).attr("unselectable",t?"off":"on").css("MozUserSelect",t?"":"none")},dontstart:function(){return!1},callback:function(){}};r.callback.prototype={update:function(){n.drop&&this.available.length&&e.each(this.available,function(e){n.drop.locate(this,e)})}};n.draginit=n.dragstart=n.dragend=r})(jQuery);