window.InfusePages={pageData:null,init:function(){var e=this;$(".infusePagesCkeditor").each(function(){var e=$(this).ckeditor();e.editor.on("contentDom",function(t){e.editor.document.on("keydown",function(t){if(t.data.$.ctrlKey&&t.data.$.which==69){var n=$(e.editor.container.$).parent().find(".infusePagesCkeditor");sessionStorage.setItem("infuse_pages_edit_description",n.val());n.text("");n.attr("placeholder","enter description and return");$(e.editor.container.$).hide();n.show().css("visibility","visible")}})})});$("body").hasClass("developer")&&e.developerMode();e.pageData=$(".pageDataPassToJs").data("page-data");e.pageData.originalPageValues=e.pageData.pageValues;e.pageData.pageValues=[];$(".infusePageForm").submit(function(t){var n=$(".saveSubmitButton");n.attr("disabled",!0);e.infusePageSerialize();$("textarea.pageData").val(JSON.stringify(e.pageData));return!0});$(document).on("change",".btn-file :file",function(){var e=$(this),t=e.get(0).files?e.get(0).files.length:1,n=e.val().replace(/\\/g,"/").replace(/.*\//,"");e.trigger("fileselect",[t,n])});$(".btn-file :file").on("fileselect",function(e,t,n){var r=$(this);textInput=r.parent().parent().siblings("input.form-control");textInput.val(n)});$(".infuseSubPageCreateId").val(chance.hash({length:15}));$("[data-method]").append(function(){return"\n<form action='"+$(this).attr("href")+"' method='POST' style='display:none'>\n"+"   <input type='hidden' name='_method' value='"+$(this).attr("data-method")+"'>\n"+"</form>\n"}).removeAttr("href").attr("style","cursor:pointer;").attr("onclick","if (confirm('Confirm delete? All nested pages will be deleted also.')) $(this).find(\"form\").submit();")},developerMode:function(){var e=this,t=$(".infusePage form"),n=$(".jumbotron");t.find(".form-group").length==0&&n.removeClass("hide");$(".draggable").draggable({helper:"clone",opacity:.35,zIndex:200,connectToSortable:".sortable",start:function(e,t){}});var r=function(t,i){if(i.item.is("a.draggable")){n.hasClass("hide")||n.addClass("hide");i.item.hasClass("addText")&&i.item.replaceWith(e.createText());i.item.hasClass("addTextBox")&&i.item.replaceWith(e.createTextBox());i.item.hasClass("addUpload")&&i.item.replaceWith(e.createUpload());i.item.hasClass("addDivider")&&i.item.replaceWith(e.createDivider());if(i.item.hasClass("addGroup")){i.item.remove();var s=e.createGroup();s.find(".formBlock.sortable").sortable({placeholder:"ui-state-highlight",stop:r,items:".form-group:not(.unsortable)"}).droppable({greedy:!0});$(".form-horizontal").append(s)}}};$(".formBlock.sortable").sortable({placeholder:"ui-state-highlight",stop:r,items:".form-group:not(.unsortable)"}).droppable({greedy:!0});$("html").droppable({drop:function(e,r){r.draggable.remove();t.find(".form-group").length==0?n.removeClass("hide"):n.addClass("hide")}});var i=$(window).height();$("body").css("min-height",$(window).height()-25+"px");$(window).resize(function(){var e=$(this).height();$("body").css("min-height",$(this).height()-25+"px")});var s=new ZeroClipboard($(".infusePage .form-group .glyphicon.glyphicon-paperclip"));e.inputEditEvents()},inputEditEvents:function(){$(document).on("keypress",".quickEdit input",function(e){var t=$(this);if(e.which==13){var n=t.parent().find("span");n.data("serialize-tag")=="pageTitle"?n.text(t.val()):n.data("serialize-tag")=="pageDescription"&&n.text(t.val());t.toggle();n.toggle();e.preventDefault()}});$(document).on("dblclick",".quickEdit",function(e){var t=$(this);t.find("input").toggle();t.find("span").toggle()});$(document).on("keypress",".inputTextEditEvent",function(e){var t=$(this);if(e.which==13){if(t.attr("placeholder")=="enter title and return"){t.siblings(".input-group-addon").text(t.val());t.data("serialize-page-value-name",t.val());t.val(null);t.attr("placeholder","enter description and return")}else if(t.attr("placeholder")=="enter description and return"){t.parent().parent().find(".infuseLabels .label").text(t.val());t.data("serialize-page-value-description",t.val());var n=window.Infuse.isBlank(sessionStorage.getItem("infuse_pages_edit_description"))?"":sessionStorage.getItem("infuse_pages_edit_description");sessionStorage.setItem("infuse_pages_edit_description",null);t.val(n);t.attr("placeholder","value");t.data("serialize-page-value",1)}e.preventDefault()}if(e.ctrlKey&&e.which==101){sessionStorage.setItem("infuse_pages_edit_description",t.val());t.val(null);t.attr("placeholder","enter description and return")}});$(document).on("keypress",".groupEditEvent",function(e){var t=$(this);if(e.which==13){if(t.attr("placeholder")=="enter title and return"){t.parent().find("span").text(t.val());t.parent().parent().attr("data-serialize-page-value-name",t.val());t.val(null);t.attr("placeholder","enter description and return")}else if(t.attr("placeholder")=="enter description and return"){t.parent().parent().find("p").text(t.val());t.parent().parent().attr("data-serialize-page-value-description",t.val());t.val(null);t.attr("placeholder","enter title and return");t.hide();t.parent().parent().data("serialize-page-value",1)}e.preventDefault()}if(e.ctrlKey&&e.which==101){sessionStorage.setItem("infuse_pages_edit_description",t.val());t.val(null);t.attr("placeholder","enter description and return")}});$(document).on("dblclick",".groupEditActivateEvent",function(e){var t=$(this);t.parent().find("input").toggle()});$(document).on("keypress",".textareaEditEvent",function(e){var t=$(this);if(e.which==13){t.parent().parent().find(".infuseLabels .label").text(t.context.value);t.data("serialize-page-value-description",t.context.value);var n=window.Infuse.isBlank(sessionStorage.getItem("infuse_pages_edit_description"))?"":sessionStorage.getItem("infuse_pages_edit_description");sessionStorage.setItem("infuse_pages_edit_description",null);t.val(n);t.attr("placeholder","value");t.hide().css("visibility","hidden");t.parent().find(".cke").show();e.preventDefault()}});$(document).on("keypress",".initialTextareaEditEvent",function(e){var t=$(this);if(e.which==13){if(t.attr("placeholder")=="enter title and return"){t.siblings(".input-group-addon").text(t.val());t.val(null);t.attr("placeholder","enter description and return")}else if(t.attr("placeholder")=="enter description and return"){var n=$("<textarea>").addClass("infusePagesCkeditor form-control infusePageSerialize textareaEditEvent").attr("data-serialize-page-value-id",chance.hash({length:15})).attr("data-serialize-page-value-name",t.siblings(".input-group-addon").text()).attr("data-serialize-page-value-description",t.val()).attr("data-serialize-page-value",0);t.parent().parent().find(".infuseLabels .label").text(t.val());var r=window.Infuse.isBlank(sessionStorage.getItem("infuse_pages_edit_description"))?"":sessionStorage.getItem("infuse_pages_edit_description");sessionStorage.setItem("infuse_pages_edit_description",null);t.val(r);t.attr("placeholder","value");t.replaceWith(n);var i=n.ckeditor();i.editor.on("contentDom",function(e){$(i.editor.container.$).parent().find(".infusePagesCkeditor").data("serialize-page-value",1);i.editor.document.on("keydown",function(e){if(e.data.$.ctrlKey&&e.data.$.which==69){var t=$(i.editor.container.$).parent().find(".infusePagesCkeditor");sessionStorage.setItem("infuse_pages_edit_description",t.val());t.text("");t.attr("placeholder","enter description and return");$(i.editor.container.$).hide();t.show().css("visibility","visible")}})})}e.preventDefault()}});$(document).on("keypress",".initialUploadInputEvent",function(e){var t=$(this);if(e.which==13){if(t.attr("placeholder")=="enter title and return"){t.siblings(".input-group-addon").text(t.val());t.val(null);t.attr("placeholder","enter description and return")}else if(t.attr("placeholder")=="enter description and return"){var n=t.val();t.parent().parent().find(".infuseLabels .label").text(n);t.siblings(".input-group-btn").find(".infusePageSerialize").data("serialize-page-value-description",n);var r=window.Infuse.isBlank(sessionStorage.getItem("infuse_pages_edit_description"))?"":sessionStorage.getItem("infuse_pages_edit_description");sessionStorage.setItem("infuse_pages_edit_description",null);t.val(r);t.attr("placeholder","no file");if(t.siblings(".input-group-btn").length==0){var i=$("<div>").addClass("input-group-btn"),s=$("<span>").addClass("btn btn-default btn-file").attr("tabindex","-1").text("Browseâ€¦"),o=$("<input>").attr("type","file").addClass("infusePageSerialize").attr("data-serialize-page-value-id",chance.hash({length:15})).attr("data-serialize-page-value-name",t.siblings(".input-group-addon").text()).attr("data-serialize-page-value-description",n).attr("data-serialize-page-value",1).on("fileselect",function(e,t,n){var r=$(this);textInput=r.parent().parent().siblings("input.form-control");textInput.val(n)});t.val("");s.append(o);i.append(s);t.after(i)}t.attr("readonly","readonly");t.blur()}e.preventDefault()}if(e.ctrlKey&&e.which==101){sessionStorage.setItem("infuse_pages_edit_description",t.val());t.val(null);t.removeProp("readonly");t.attr("placeholder","enter description and return")}})},createUpload:function(){var e=this,t=$("<span>").addClass("input-group-addon"),n=$("<input>").attr("type","text").attr("name","name").addClass("form-control initialUploadInputEvent").attr("placeholder","enter title and return"),r=$("<div>").addClass("input-group").append(t).append(n);return e.createTemplate(r)},createDivider:function(){var e=$("<div>").addClass("infuseDivider infusePageSerialize").attr("data-serialize-tag","divider").attr("data-serialize-page-value-id",chance.hash({length:15})).attr("data-serialize-page-value-name","").attr("data-serialize-page-value-description","").attr("data-serialize-page-value",1),t=$("<div>").addClass("col-sm-12 col-xs-12").append(e),n=$("<div>").addClass("form-group").append(t);return n},createTemplate:function(e){var t=$("<span>").addClass("glyphicon glyphicon-paperclip"),n=new ZeroClipboard(t),r=$("<span>").addClass("label label-default-bryan"),i=$("<div>").addClass("infuseLabels").append(r),s=$("<div>").addClass("col-sm-12 col-xs-12").append(e).append(t).append(i),o=$("<div>").addClass("form-group").append(s);return o},createText:function(){var e=this,t=$("<span>").addClass("input-group-addon"),n=$("<input>").attr("type","text").attr("name","name").addClass("form-control infusePageSerialize inputTextEditEvent").attr("placeholder","enter title and return").attr("data-serialize-page-value-id",chance.hash({length:15})).attr("data-serialize-page-value-name","").attr("data-serialize-page-value-description","").attr("data-serialize-page-value",0),r=$("<div>").addClass("input-group").append(t).append(n);return e.createTemplate(r)},createGroup:function(){var e=this,t=$("<input>").attr("type","text").attr("name","name").addClass("form-control groupEditEvent").attr("placeholder","enter title and return"),n=$("<span>").addClass("groupEditActivateEvent"),r=$("<div>").addClass("panel-heading").append(n).append(t),i=$("<div>").addClass("formBlock sortable"),s=$("<p>"),o=$("<div>").addClass("panel-body").append(s).append(i),u=$("<div>").addClass("panel panel-default infusePageSerialize").attr("data-serialize-tag","group").attr("data-serialize-page-value-id",chance.hash({length:15})).attr("data-serialize-page-value-name","").attr("data-serialize-page-value-description","").attr("data-serialize-page-value",0).append(r).append(o);return u},createTextBox:function(){var e=this,t=$("<span>").addClass("input-group-addon"),n=$("<input>").attr("type","text").attr("name","name").addClass("form-control initialTextareaEditEvent").attr("placeholder","enter title and return"),r=$("<div>").addClass("input-group").append(t).append(n);return e.createTemplate(r)},infusePageSerialize:function(){var e=this,t=$(".formBlock:nth-child(1) .infusePageSerialize, .sectionInfo .infusePageSerialize");$.each(t,function(){var t=$(this);switch(t.data("serialize-tag")){case"pageTitle":e.pageData.pageProperties.pageTitle=t.text().trim();break;case"pageDescription":e.pageData.pageProperties.pageDescription=t.text().trim();break;default:var n=e.infusePageSerializePrepItem(t);n&&e.pageData.pageValues.push(n)}});$(".panel.infusePageSerialize").each(function(){var t=$(this),n=[];t.find(".panel-body .infusePageSerialize").each(function(){var t=$(this),r=e.infusePageSerializePrepItem(t);r&&n.push(r)});if(n.length>0&&t.data("serialize-page-value")==1){var r={id:t.data("serialize-page-value-id").trim(),type:"group",name:t.data("serialize-page-value-name").trim(),value:n,description:t.data("serialize-page-value-description").trim()};e.pageData.pageValues.push(r)}})},infusePageSerializePrepItem:function(e){var t={id:"",type:"",name:"",value:"",description:""};if(e.data("serialize-page-value")==1){t.id=e.data("serialize-page-value-id").trim();t.name=e.data("serialize-page-value-name").trim();t.description=e.data("serialize-page-value-description").trim();t.value=e.val().trim();if(e.is("input"))e.attr("type")=="text"?t.type="string":e.attr("type")=="file"&&(t.type="upload");else if(e.is("textarea"))t.type="text";else if(e.has("infuseDivider")){t.type="divider";t.value=""}else t=!1}else t=!1;return t}};$(document).ready(function(){$.ajaxSetup({headers:{"X-CSRF-Token":$('meta[name="csrf-token"]').attr("content")}});window.Infuse={capitaliseFirstLetter:function(e){return this.replaceUnderscore(e.charAt(0).toUpperCase()+e.slice(1))},replaceUnderscore:function(e){return e.replace(/_/g," ")},properName:function(e){return this.replaceUnderscore(this.capitaliseFirstLetter(e))},isFloat:function(e){return+e===e&&(!isFinite(e)||!!(e%1))},isInt:function(e){return e===+e&&isFinite(e)&&!(e%1)},isBlank:function(e){return!e||/^\s*$/.test(e)},confirmAndblockUI:function(e,t){if(confirm("Confirm "+e+"?")){$.blockUI({message:$("."+t).html()});return!0}return!1}};var e=!1;$("nav.center").each(function(){var e=$(this).data("nav-level-active");if(e!=""){var t=$('li.list-group-item[data-active="'+e+'"]');t.addClass("active");t.parent().parent().parent().addClass("in");$(".sideNavSlideOut").toggle()}});$(".infuseManage").bind("click",function(e){e.preventDefault();$(".sideNavSlideOut").toggle()});$(".placeholder").placeholder();$(".focusPassword").focus(function(){$(this).attr("type","password")});$(".placeholder").placeholder();$(".infuseLogin form").submit(function(){var e=$(this).validate({errorClass:"errorInput"});return e.bool});$(".sideNavSlideOut .panel-heading a").on("click",function(e){if($(this).parent().parent().find(".panel-collapse").hasClass("in")){e.stopPropagation();e.preventDefault()}});$(".dropdown-menu-form .checkbox").on("click",function(e){e.stopPropagation()});$(document).on("change",".btn-file :file",function(){var e=$(this),t=e.get(0).files?e.get(0).files.length:1,n=e.val().replace(/\\/g,"/").replace(/.*\//,"");e.trigger("fileselect",[t,n])});$(".btn-file :file").on("fileselect",function(e,t,n){var r=$(this);textInput=r.parent().parent().siblings("input.form-control");textInput.val(n)});if($(".InfuseController").length>0){$(".infoPopOver").popover();$(".infuseCkeditor").each(function(){var e=$(this);config=e.data("config");typeof window[config]=="undefined"?e.ckeditor():e.ckeditor(window[config])});$(".selectedDateTime").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"HH:mm:ss",pickerTimeFormat:"hh-mm-tt"});$(".selectedDate").datepicker({dateFormat:"yy-mm-dd"});$(".infuseBoolean").change(function(){var e=$(this).is(":checked"),t=String($(this).attr("name")),n={id:$(this).data("id"),value:e,column_name:t};$.ajax({type:"POST",url:$(this).data("url"),data:n,success:function(e){console.log(e)},error:function(e,t,n){}})});var t=0;$(".filterColumn").click(function(e){e.preventDefault();t++;var n=$(this),r=$("<input class='filterInput"+t+"' type='text' >");$(".appendFilters").append(r.wrap("<div class='control-group'>"));var i=$(".filterInput"+t).magicSuggest({width:495,name:"filter_"+t,maxSelectioninteger:3,emptyText:"Type here",displayField:"value",value:[n.data("filter-column"),"contains"],data:[{id:n.data("filter-column"),value:n.text()},{id:"contains",value:"contains"},{id:"equals",value:"equals"},{id:"less than",value:"less than"},{id:"greater than",value:"greater than"},{id:"not equal to",value:"not equal to"}]});$(".filtersContainer").slideDown();$(".filterCount").val(t);n.parent().addClass("hide");$(".downloadCSVLink").attr("href",$(".downloadCSVLink").data("filter-download"))});$(".rebuildFiltersThroughJs div").each(function(){t++;var e=$(this),n=e.data("filter-"+t+"-first"),r=e.data("filter-"+t+"-second"),i=e.data("filter-"+t+"-third"),s=e.data("filter-"+t+"-first-display"),o=$("<input class='filterInput"+t+"' type='text' >");$(".appendFilters").append(o.wrap("<div class='control-group'>"));var u=$(".filterInput"+t).magicSuggest({width:495,name:"filter_"+t,maxSelectioninteger:3,emptyTextstring:"Type here",displayField:"value",value:[n,r,i],data:[{id:n,value:s},{id:"contains",value:"contains"},{id:"equals",value:"equals"},{id:"less than",value:"less than"},{id:"greater than",value:"greater than"},{id:"not equal to",value:"not equal to"},{id:i,value:i}]});$(".filtersContainer").slideDown();$(".filterCount").val(t);$(".filter"+n).parent().addClass("hide");$(".downloadCSVLink").attr("href",$(".downloadCSVLink").data("filter-download"))});$(".clearFilters").click(function(e){$(".appendFilters").empty();$(".filtersForm").submit()});$(".imageCrop").click(function(){var e=$(this),t=e.parent();id=e.data("id"),path=e.data("path"),width=e.data("width"),height=e.data("height"),loaderHtml='<div class="loader bubblingG"><span id="bubblingG_1"></span><span id="bubblingG_2"></span><span id="bubblingG_3"></span></div> ',imagePreviewCrop=e.next(".imagePreviewCrop");imagePreviewCrop.fadeIn();t.find(".imagePreviewCropOn").prop("disabled",!0).hide();e.hide();var n={uploadUrl:path,uploadData:{action:"upload_temp_image"},cropUrl:path,cropData:{action:"crop_image_send_back_url"},modal:!0,imgEyecandyOpacity:.4,loaderHtml:loaderHtml,width:width,height:height,onAfterImgCrop:function(){imagePreviewCrop.height(200);$("#"+id+"CroppedImage").val(t.find("#"+id+" .croppedImg").attr("src"))},afterCropControlRemoveCroppedImage:function(){imagePreviewCrop.height(30);imagePreviewCrop.hide();e.show();t.find(".imagePreviewCropOn").prop("disabled",!1).show();$("#"+id+"CroppedImage").val("")}},r=new Croppic(id,n);$("."+id+"_imgUploadForm").find('input[type="file"]').trigger("click")});$(".childOrderColumn").on("click",".childUpOrder",function(e){e.preventDefault();var t=$(this),n=t.data("id"),r=t.data("url"),i=t.data("model"),s=t.data("column"),o=t.parent().parent().data("class"),u=t.closest("tr"),a=u.prev().find(".childUpOrder").data("id");$("tr."+o).index(t.parent().parent())!=0&&$.ajax({type:"POST",url:r,data:{action:"swap_order",column:s,prevId:a,id:n,model:i,column:s},success:function(e){e.success?u.prev().insertAfter(u):alert("Failed to reorder entries.")},error:function(e,t,n){}});return!1});$(".childOrderColumn").on("click",".childDownOrder",function(e){e.preventDefault();var t=$(this),n=t.data("id"),r=t.data("url"),i=t.data("model"),s=t.data("column"),o=t.closest("tr"),u=o.next().find(".childUpOrder").data("id");o.next().length>0&&$.ajax({type:"POST",url:r,data:{action:"swap_order",column:s,prevId:u,id:n,model:i,column:s},success:function(e){e.success?o.insertAfter(o.next()):alert("Failed to reorder entries.")},error:function(e,t,n){}});return!1});$(".orderColumn").on("click",".upOrder",function(e){e.preventDefault();var t=$(this),n=t.data("id"),r=t.data("url"),i=t.data("model"),s=t.data("column"),o=t.parent().parent().data("class"),u=t.closest("tr"),a=u.prev().find(".upOrder").data("id");$("tr."+o).index(t.parent().parent())!=0&&$.ajax({type:"POST",url:r,data:{action:"swap_order",column:s,prevId:a,id:n,model:i,column:s},success:function(e){e.success?window.location.href=r:alert("Failed to reorder entries.")},error:function(e,t,n){}});return!1});$(".orderColumn").on("click",".downOrder",function(e){e.preventDefault();var t=$(this),n=t.data("id"),r=t.data("url"),i=t.data("model"),s=t.data("column"),o=t.closest("tr"),u=o.next().find(".upOrder").data("id");o.next().length>0&&$.ajax({type:"POST",url:r,data:{action:"swap_order",column:s,prevId:u,id:n,model:i,column:s},success:function(e){e.success?window.location.href=r:alert("Failed to reorder entries.")},error:function(e,t,n){}});return!1});var n=0,r=[];$(".multiSelect").each(function(){n++;var e=$(this),t=e.data("data"),i=e.data("name"),s=String(e.data("value"));for(var o=0;o<t.length;o++)t[o].id=parseInt(t[o].id);if(s.indexOf(",")!==-1){var u=new Array;$.each(s.split(","),function(e,t){u.push(parseInt(t))});s=u}else{var u=new Array;u[0]=parseInt(s);isNaN(u[0])&&(u=new Array);s=u}r[i]=e.magicSuggest({allowFreeEntries:!1,name:i+n,emptyText:"Click arrow to add",displayField:"value",value:s,data:t});$(r[i]).on("selectionchange",function(e,t,n){$(".multiSelect"+i).val(r[i].getValue())})});setTimeout(function(){$.ajax({type:"POST",url:window.location.href,data:{action:"clean_temp_folder"},success:function(e){e.status=="success"},error:function(e,t,n){}})},1e3);function i(e){var t=e.height()-(e.find(".modal-header").height()+18+e.find(".modal-footer").height()+30);e.find(".modal-body").height(t)}var s=$(".importModal"),o="form.search";s.on("show",function(){var e=$(this);if(parseInt(e.data("first"))){e.data("first",0);u("",1)}});s.on("shown",function(){var e=$(this);i(e);$(window).resize(function(){i(e)})});s.on("hide",function(){var e=$(this);e.find(".modal-body .importModalAccordion, .modal-body .addedRow").remove();e.data("first",1);e.find(" .searchBox .searchInput").val("")});s.find(".loadMoreResultsPrev").on("click",function(e){var t=$(this);e.preventDefault();if(parseInt(t.data("allow"))==1)if(o=="form.search"){var n=s.find(" .searchBox form.search  .searchInput").val();u(n,parseInt(t.data("active_page"))-1)}else if(o=="form.advancedSearch"){var r={},i=null;r.search=s.find(".searchField").val(),r.distance=parseInt(s.find(".distance").val()),i=s.find(".searchLatitudeLongitude").val();if(!Infuse.isInt(r.distance)){alert("Distance must be an integer.");return!1}if(i.indexOf(",")==-1){alert("Latitude & Longitude format inccorect don't forget the comma.");return!1}i=i.split(",");r.latitude=parseFloat(i[0]);r.longitude=parseFloat(i[1]);if(!Infuse.isFloat(r.latitude)||!Infuse.isFloat(r.longitude)){alert("Latitude & Longitude must be numbers.");return!1}o="form.advancedSearch";u(r,parseInt(t.data("active_page"))-1)}});s.find(".loadMoreResultsNext").on("click",function(e){var t=$(this);e.preventDefault();if(parseInt(t.data("allow"))==1)if(o=="form.search"){var n=s.find(" .searchBox form.search  .searchInput").val();u(n,parseInt(t.data("active_page"))+1)}else if(o=="form.advancedSearch"){var r={},i=null;r.search=s.find(".searchField").val(),r.distance=parseInt(s.find(".distance").val()),i=s.find(".searchLatitudeLongitude").val();if(!Infuse.isInt(r.distance)){alert("Distance must be an integer.");return!1}if(i.indexOf(",")==-1){alert("Latitude & Longitude format inccorect don't forget the comma.");return!1}i=i.split(",");r.latitude=parseFloat(i[0]);r.longitude=parseFloat(i[1]);if(!Infuse.isFloat(r.latitude)||!Infuse.isFloat(r.longitude)){alert("Latitude & Longitude must be numbers.");return!1}o="form.advancedSearch";u(r,parseInt(t.data("active_page"))+1)}});s.find(" .searchBox form").submit(function(e){e.preventDefault();var t=$(this);if(t.hasClass("search")){var n=t.find(".searchInput").val();o="form.search";u(n,1)}else if(t.hasClass("advancedSearch")){var r={},i=null;r.search=t.find(".searchField").val(),r.distance=parseInt(t.find(".distance").val()),i=t.find(".searchLatitudeLongitude").val();if(!Infuse.isInt(r.distance)){alert("Distance must be an integer.");return!1}if(i.indexOf(",")==-1){alert("Latitude & Longitude format inccorect don't forget the comma.");return!1}i=i.split(",");r.latitude=parseFloat(i[0]);r.longitude=parseFloat(i[1]);if(!Infuse.isFloat(r.latitude)||!Infuse.isFloat(r.longitude)){alert("Latitude & Longitude must be numbers.");return!1}o="form.advancedSearch";u(r,1)}});function u(e,t){e=typeof e!="undefined"?e:"";t=typeof t!="undefined"?t:1;var n={};if(typeof e=="object")n=e,e=n.search;else{n.latitude="";n.longitude="";n.distance=""}e=e=="Search..."?"":e;var r=$(".importModal"),i=r.attr("id");list=r.data("list"),map=r.data("map"),child=r.data("child"),resource=r.data("resource"),loading=r.find(".loading"),modelImportingTo=r.data("model-importing-to"),modelImportingToId=r.data("model-importing-to-id"),foriegnKey=r.data("related-foriegn-key"),parentId=r.data("related-parent-id");loading.show();r.find(".modal-body .importModalAccordion, .modal-body .addedRow").remove();$.ajax({type:"POST",url:window.location.pathname,data:{action:"fetch_import_batch",child:child,resource:resource,search:e,list:list,map:map,pg:t,id:i,modelImportingToId:modelImportingToId,modelImportingTo:modelImportingTo,latitude:n.latitude,longitude:n.longitude,distance:n.distance,foriegnKey:foriegnKey,parentId:parentId},success:function(e,t,n){var r=$(".importModal"),i=r.data("list");if(e.status=="success"){r.find(".loading").hide();if(e.entries.length>0){r.find("table").append(e.entries_html);a(e.pagination,r)}else f(r,i)}else if(e.status=="error"){r.find(".loading").hide();alert(e.flash.message)}n=null,t=null},error:function(e,t,n){}});i=null,list=null,map=null,child=null,resource=null,e=null,loading=null,r=null}function a(e,t){var n=Math.ceil(parseInt(e.count)/parseInt(e.limit));t.find(".loadMoreResultsPrev, .loadMoreResultsNext").data("active_page",e.active_page);parseInt(e.active_page)!=1?t.find(".loadMoreResultsPrev").data("allow",1).parent().removeClass("disabled"):t.find(".loadMoreResultsPrev").data("allow",0).parent().addClass("disabled");e.active_page!=n?t.find(".loadMoreResultsNext").data("allow",1).parent().removeClass("disabled"):t.find(".loadMoreResultsNext").data("allow",0).parent().addClass("disabled");n=null,loadMoreResults=null,e=null,t=null}function f(e,t){e.find(".modal-body .importModalAccordion, .modal-body .addedRow").remove();var n=$("<tr>").addClass("addedRow"),r=$("<td>").attr("colspan",t.length+1).text("No Results.");n.append(r);e.find("table").append(n);n=null,r=null,e=null,pagination=null}$(document).on("click",".addedRow",function(){var e=$(this);$(".iconImportAccordion").removeClass("icon-chevron-down").addClass("icon-chevron-right");e.find(".iconImportAccordion").addClass("icon-chevron-down");$(".importModalAccordion").hide();e.next(".importModalAccordion").slideDown()});$(document).on("click",".importEntry",function(e){e.preventDefault();var t=$(this),n=t.data("modal-id"),r=t.closest(".importModalAccordion").find("input:checked"),i=$(".editCreateForm"),s=new Array;$.each(r,function(){var e=$(this),t=e.data("value"),n=e.data("overite-column"),r=e.data("attachment");if(r=="image"){var o=n.split("@");n=o[0];i.find(".importReplace"+n).attr("type","text").val(t)}else if(String(r).indexOf("combine_")>-1){var o=n.split("@");n=o[0],combineColumn=o[1].split("_"),combineColumn=combineColumn[1];combineColumn in s?s[combineColumn].push(n+"#"+t):s[combineColumn]=new Array(n+"#"+t)}else if(r=="convert_text"){var o=n.split("@");n=o[0],newInput=null,oldInput=i.find(".importReplace"+n);$(".importRemove"+n).remove();if(n in s){t=n+"#"+t;for(var u in s[n])t=t+"|"+s[n][u]}oldInput.is("input")?i.find(".importReplace"+n).attr("type","text").val(t):oldInput.is("select")&&i.find(".importReplace"+n).find("option").remove().end().append('<option value="'+t+'">'+t+"</option>").val(t)}else i.find(".importReplace"+n).val(t)});$("#"+n).modal("hide");var o=$("<div>").addClass("alert alert-success"),u=$("<button>").addClass("close").attr("type","button").data("dismiss","alert").html("&times;").on("click",function(){$(this).parent().remove()}),a=$("<h4>").text("Successfully imported fields.");o.append(u).append(a);$(".page-header").append(o)});$(".oneRolePerUser").change(function(){var e=$(this);this.checked&&$(".oneRolePerUser").not(e).prop("checked",!1)});$(".editCreateForm form").submit(function(e){var t=$(".saveSubmitButton");t.attr("disabled",!0)});$(".saveSubmitButton").click(function(){var e=$(this).data("type-submit");$("input[data-type-submit="+e+"]").val("SAVING..");var t=$("#typeSubmit");t.length>0&&t.val(e)});$(document).on("click",".importCheckAll",function(e){e.preventDefault();var t=$(this),n=t.data("all-on")==1?!0:!1,r=t.parent().parent().parent().find(".checkAll");if(n){r.prop("checked",!1);t.data("all-on",0);t.text("Check All")}else{r.prop("checked",!0);t.data("all-on",1);t.text("Uncheck All")}})}});